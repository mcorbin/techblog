<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>(mcorbin.fr): Le métier de développeur Cloud</title>
    <link rel="canonical" href="https://mcorbin.fr/posts/2020-11-29-developpeur-cloud/">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/styles/tomorrow-night.css" rel="stylesheet" type="text/css" />
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
    <script src="/js/jquery-3.5.1.min.js" type="text/javascript"></script>
  </head>
  <body><a name="top"></a>
    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar1" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">(mcorbin.fr)</a>
        </div>
        <div id="navbar1" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li ><a href="/">Home</a></li>
            <li
               ><a href="/archives/">Archives</a></li>
            
            <li
               >
              <a href="/pages/about/">About</a>
            </li>
            
            <li
               >
              <a href="/pages/projects/">Projects</a>
            </li>
            
            <li><a href="/feed.xml">RSS</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div><!--/.container-fluid -->
    </nav>


    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div id="content">
            
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">29 novembre 2020</div>
        
    </div>
    <h2>Le métier de développeur Cloud</h2>
</div>
<div>
    
    <div class="paragraph">
<p>J&#8217;ai récemment eu l&#8217;occasion de parler (rapidement) lors d&#8217;une table ronde de mon métier. J&#8217;avais préparé pour cette occasion des réponses à un certain nombre de questions, et je me dis qu&#8217;en faire un article peut être intéressant.</p>
</div>
<div class="sect1">
<h2 id="_pourquoi_cet_article">Pourquoi cet article</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je me suis rendu compte que l&#8217;on parle beaucoup du Cloud mais très peu de comment le Cloud est implémenté, et du travail de développeur chez un Cloud Provider.<br>
Au cours de discussions où je parlais du Cloud avec des gens, j&#8217;ai souvent eu des retours me disant des choses comme "je me suis jamais demandé comment cela fonctionnait" ou bien "je ne pensais pas du tout à tous ses aspects en tant qu&#8217;utilisateur".</p>
</div>
<div class="paragraph">
<p>Pourtant, c&#8217;est un domaine très intéressant (bien qu&#8217;assez spécifique) où l&#8217;on ne s&#8217;ennuie jamais. J&#8217;entends souvent dire "Le Cloud c&#8217;est de la magie", vraiment ?</p>
</div>
<div class="paragraph">
<p>Bref, c&#8217;est quoi mon job ?</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_cloud">Le Cloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vous êtes peut être utilisateur de services Cloud pour déployer vos applications.</p>
</div>
<div class="paragraph">
<p>Vous cliquez sur un bouton, un groupe de machines se déploie, vous cliquez sur un autre bouton et un load balancer est installé devant ces machines, répartissant le trafic sur vos applications et exécutant des healthchecks.<br>
Vous faites un appel API (utilisant une CLI par exemple), de nouvelles machines se déploient, le load balancer est automatiquement mis à jour. Un autre appel, et c&#8217;est un cluster Kubernetes qui se déploie&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Derrière tous ces services, il y a (entre autre) des programmes. Ces programmes, il faut les développer. C&#8217;est le travail d&#8217;un développeur ou d&#8217;une développeuse Cloud.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_développer_sa_stack_cloud">Développer sa stack Cloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Exoscale, nous développons notre propre solution Cloud. On ne se contente pas d&#8217;utiliser des solutions toutes faites, mais développons nos propres solutions, nos propres orchestrateurs, et c&#8217;est je pense un point très important.</p>
</div>
<div class="paragraph">
<p>On m&#8217;a parfois demandé "mais ça apporte quoi d&#8217;avoir sa propre solution et pas une solution toute faite" ? Cela a selon moi plusieurs avantages.</p>
</div>
<div class="paragraph">
<p>Déjà, pouvoir faire ses propres choix technologiques. A Exoscale, la majorité des programmes sont écrits en <a href="https://clojure.org/">Clojure</a> (même si l&#8217;on a quand même un peu de Java, Go, C, Python&#8230;&#8203; car finalement chaque langage a son utilisation) et je pense que le choix de Clojure est en partie responsable de notre capacité actuelle à sortir rapidement (et maintenir et faire évoluer) des services fiables, le tout par de petite équipes (vous seriez je pense surpris de combien de personnes maintiennent les différents projets).<br>
Mais cela sera sûrement le sujet d&#8217;un article dédié.</p>
</div>
<div class="paragraph">
<p>Ensuite, même quand vous utilisez des solutions Cloud toutes faites, vous allez devoir les maîtriser sur le bout des doigts, les forker, contribuer, parfois dériver de l&#8217;implémentation originale car cette dernière ne correspond pas ou plus à vos besoins (peut être que les mainteneurs originaux ne sont pas intéressés par vos changements car trop spécifiques ?)&#8230;&#8203;<br>
Bref, au final vous vous retrouvez également avec votre propre solution Cloud qui est un fork de l&#8217;originale (bonne chance pour les rebase), avec des centaines de milliers ou millions de lignes de codes à maintenir.<br>
De plus, les solutions toutes faites sont conçues pour tourner de plein de façons différentes, sur plein de hardware différents, alors que vous, vous savez généralement ce que vous voulez. Bref, vous avez un paquet de code mort que vous devez quand même maintenir.</p>
</div>
<div class="paragraph">
<p>Parlons égalemement du tooling. Si vous utilisez une solution Cloud générique, et que vous proposez ensuite un produit seulement disponible chez vous, est ce que les mainteneurs de la solution générique approuveront l&#8217;ajout de votre solution spécifique dans leurs outils (Terraform, CLI&#8230;&#8203;) ? Probablement que non.</p>
</div>
<div class="paragraph">
<p>Avoir sa propre solution permet de travailler rapidement, d&#8217;innover, et de sortir des produits Cloud fonctionnant avec des programmes simples et performants, sur une stack qu&#8217;on maitrise de A à Z.</p>
</div>
<div class="paragraph">
<p>Mais revenons au métier de développeur Cloud.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_la_difficulté_du_cloud">La difficulté du Cloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Un Cloud peut être vu qu&#8217;une certaine façon comme un système distribué. Prenons un exemple d&#8217;infrastructure toute simple: un groupe de machines virtuelles dans un réseau privé et avec un load balancer en front.</p>
</div>
<div class="paragraph">
<p>On a déjà ici différents composants; des machines, un réseaux privé, un load balancer. Chacun de ces composants est "déployé" quelque part:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Les machines tournent sur des hyperviseurs. Le disque de la machine (en cas de stockage local) est également présent sur l&#8217;hyperviseur.</p>
</li>
<li>
<p>Des règles réseaux (que ce soit pour les interfaces publiques ou privées) doivent être installées sur les hyperviseurs (comme vous vous en doutez il faut router les paquets là où il faut).</p>
</li>
<li>
<p>Des machines hébergent le composant faisant le load balancing (à Exoscale, quand vous créez un load balancer vous avez d&#8217;ailleurs deux instances en <strong>actif/actif</strong> de déployée). Ce composant est configuré en fonction des machines du groupe de machine.</p>
</li>
<li>
<p>Des règles réseaux doivent être ajoutées sur l&#8217;hyperviseur pour chaque machine derrière le load balancer (dans notre cas, pour faire de la décapsulation IPIP et du Direct Server Return notamment, si le sujet vous intéresse j&#8217;ai un talk de prêt sur le fonctionnement interne de notre load balancer, peut être que je le ferai au format vidéo à l&#8217;occasion).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>J&#8217;oublie sûrement des trucs mais vous avez je pense saisi le problème: plusieurs composants distribués à différents endroits.</p>
</div>
<div class="paragraph">
<p>Une vue utilisateur ultra simplifiée serait:</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="/img/dev-cloud/lb_exemple.jpg" alt="un exemple d&#8217;infrastructure avec 2 load balancers et deux machines virtuelles"></span></p>
</div>
<div class="paragraph">
<p>De plus, par sa nature l&#8217;état d&#8217;une plateforme Cloud change constamment, par exemple lors d&#8217;actions utilisateurs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un utilisateur ajoute une machine au groupe de machines, elle doit être automatiquement ajoutée au réseau privé et au load balancer. Et l&#8217;inverse pour sa suppression.</p>
</li>
<li>
<p>Vous changez les règles de load balancing (par exemple, vous modifiez le healthcheck, le port de destination&#8230;&#8203;) la configuration du load balancer doit être mis à jour.</p>
</li>
<li>
<p>&lt;Insérez ici tout ce que vous pouvez faire sur un Cloud: snapshot/restore, bidouilles réseaux, firewalling, déployer des clusters kube&#8230;&#8203;&gt;.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Mais aussi parce que nous, gestionnaires du Cloud, devons réaliser des actions sur la plateforme:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mises à jour.</p>
</li>
<li>
<p>Migration (live) de machines virtuelles entre hyperviseurs. Bien sûr la machine doit migrer avec tout son état, règles réseaux incluses par exemple, et les règles doivent être nettoyées sur l&#8217;hyperviseur source.</p>
</li>
<li>
<p>Plein d&#8217;autre choses ;)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Et bien sûr, les pannes et incidents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On gère de l&#8217;infrastructure physique, l&#8217;infrastructure physique ça pète, tout simplement.</p>
</li>
<li>
<p>Il peut se passer plein de choses marrantes niveau réseau.</p>
</li>
<li>
<p>Et bien sûr, aucun programme n&#8217;est parfait, malgré tous les efforts un bug peut arriver.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On a donc une sorte de système distribué où il peut se passer plein de trucs, et bien sûr en tant que client vous voulez juste que ça marche, et si possible 24H/24 et 7H/7 :D</p>
</div>
<div class="paragraph">
<p>On a donc besoin de programmes capables de piloter des machines virtuelles, des load balancers, configurer du réseau, des clusters Kubernetes&#8230;&#8203; Et surtout de faire <strong>converger</strong> l&#8217;état global de la plateforme dans l&#8217;état voulu en cas de changement (volontaire ou non).</p>
</div>
<div class="paragraph">
<p>Et finalement, voilà ce que je fais: développer ces programmes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_agents_et_orchestrateurs">Agents et Orchestrateurs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On peut sûrement faire la distinction entre deux types de programmes chez un Cloud Provider. Les agents et les orchestrateurs.</p>
</div>
<div class="paragraph">
<p>les agents sont des daemons simples qui reçoivent des ordres. Par exemple, un agent tourne sur les hyperviseurs, expose une API qui lui permet par exemple de configurer le réseau d&#8217;une machine virtuelle. L&#8217;agent ne prend pas de décision, il reçoit un ordre ("configure moi cette machine virtuelle", "démarre cette machine", "configure ce load balancer", "configure ce réseau"&#8230;&#8203;) et l&#8217;applique.</p>
</div>
<div class="paragraph">
<p>Les orchestrateurs sont les donneurs d&#8217;ordres, et sont l&#8217;intelligence de la plateforme. C&#8217;est eux qui vont coordonner les agents (voir parler avec d&#8217;autres orchestrateurs) pour faire converger la plateforme dans l&#8217;état voulu.</p>
</div>
<div class="paragraph">
<p>C&#8217;est un domaine passionnant.</p>
</div>
<div class="paragraph">
<p>Là aussi, voici une vue <strong>simplifiée</strong> de ce qu&#8217;il se passe en réalité:</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="/img/dev-cloud/orchestration.jpg" alt="une infrastructure gérée par des orchestrateurs"></span></p>
</div>
<div class="paragraph">
<p>Il y a plein de problèmes "marrants" à régler lors de l&#8217;écriture d&#8217;orchestrateurs ou d&#8217;agents, comme par exemple:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eviter les race conditions (actions sur la même entité en parallèle)
, Ne pas perdre d&#8217;actions</p>
</li>
<li>
<p>pouvoir déclencher des exécutions de jobs depuis de multiples sources (actions utilisateurs, actions d&#8217;administration, événements&#8230;&#8203;)</p>
</li>
<li>
<p>Savoir récupérer "l&#8217;état du monde" pour une entité et construire et exécuter le job qui fera converger l&#8217;entité vers l&#8217;état voulu (les orchestrateurs sont très déclaratifs).</p>
</li>
<li>
<p>Gestion des retry et de l&#8217;alerting.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nous avons résolu ces problèmes au fil du temps pour arriver à notre solution actuelle qui continue d&#8217;ailleurs d&#8217;évoluer (et certaines librairies utilisées sont open source et disponibles sur <a href="https://github.com/exoscale/">Github</a>).<br>
Cette solution est derrière tout nos nouveaux projets depuis un petit moment déjà, et c&#8217;est <strong>très</strong> efficace.</p>
</div>
<div class="paragraph">
<p>Vous êtes intéressé par le sujet ? Nous devrions publier une série d&#8217;articles sur les orchestrateurs et notamment sur notre implémentation de notre offre de Kubernetes managé en début d&#8217;année prochaine sur le blog d&#8217;Exoscale.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_reste_de_la_plateforme">Le reste de la plateforme</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Facturation, API Gateway, outils de stream processing, gestion des utilisateurs et organisations&#8230;&#8203; sont également des choses importantes sur lesquelles on doit intervenir.</p>
</div>
<div class="paragraph">
<p>Bien sûr, il y a également chez un Cloud Provider des équipes frontend, des ingénieurs réseaux (gérer le routage interne dans les datacenters mais aussi externe), systèmes, hardware, des personnes travaillant sur le tooling (vous fournissant de supers intégrations Terraform, CLI&#8230;&#8203; dès la sortie d&#8217;un nouveau produit), des équipes orientées avant vente&#8230;&#8203;<br>
On retrouve des compétences très vastes, de l&#8217;infrastructure physique (design de rack, choix et gestion du hardware&#8230;&#8203;) jusqu&#8217;au frontend, et être en contact permanent avec des personnes travaillant dans tous ces domaines est super intéressant et enrichissant.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_les_compétences_nécessaires_pour_un_développeur_cloud">Les compétences nécessaires pour un développeur Cloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On m&#8217;avait demandé quelles sont les compétences nécessaires pour développer des produits Cloud.</p>
</div>
<div class="paragraph">
<p>En plus des compétences traditionnelles de développement (et tous les à côtés: CI/CD, monitoring, logging&#8230;&#8203;), avoir une affinité avec le monde du système et du réseau est je pense important.<br>
Mes années d&#8217;expérience d&#8217;administrateur système me sont grandement utiles, et bien qu&#8217;épaulé par des experts systèmes et réseaux (car certains produits demandent des connaissances pointues dans ces domaines) il faut comprendre les technologies et protocoles avec lesquels on travaille.<br>
Il est difficile par exemple d&#8217;écrire des agents intéragissant avec le réseau si vous ne connaissez rien en réseau. Nous (les dev) sommes également d&#8217;astreintes, donc savoir aller voir ce qu&#8217;il se passe niveau réseau pour des produits comme le load balancer est utile ;)</p>
</div>
<div class="paragraph">
<p>Mais je le redis, je ne suis pas par exemple expert réseau, et les collègues experts sur ces sujets (ops, système, réseau, virtualisation&#8230;&#8203;) sont indispensables, notamment lors du design des produits et en cas de problème critique. Nous (développeurs et développeuses) sommes accompagnés par ces experts pour implémenter les solutions.</p>
</div>
<div class="paragraph">
<p>Une autre compétence dont on ne parle très peu et qui est je pense très utile (qu&#8217;on soit dev, ops, quel que soit le domaine métier d&#8217;ailleurs), est d&#8217;arriver à garder en tête la vue d&#8217;ensemble du fonctionnement des produits que l&#8217;on développe.</p>
</div>
<div class="paragraph">
<p>Bien sûr, il y a de la documentation etc&#8230;&#8203; Mais je pense que pouvoir réfléchir sur le produit dans son ensemble (dès sa conception, pendant son implémentation, pendant sa vie) est très important.<br>
C&#8217;est comme cela que l&#8217;on peut détecter des erreurs de design, réfléchir aux différents scénarios de pannes possibles, réfléchir à comment faire communiquer les différents composants, réagir rapidement en cas de problèmes&#8230;&#8203; Bref, je pense qu&#8217;avoir cette vue d&#8217;ensemble sur les produits et sur la façon dont ils interagissent entre eux (et savoir ensuite documenter et implémenter cette vue d&#8217;ensemble) est indispensable.</p>
</div>
<div class="paragraph">
<p>Enfin, la simplicité. Je pense que concevoir des solutions simples et efficaces, reconnaître les avantages <strong>et inconvénients</strong> des technologies et outils est la clé de la réussite dans l&#8217;informatique.<br>
On parle d&#8217;ailleurs souvent de pénuries dans nos métiers. Si les gens arretaient de monter des usines à gaz (ou suivre la hype aveuglément) il faudrait selon moi déjà beaucoup moins de monde dans les projets ;)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Travailler sur un produit tech, dont nous sommes nous même utilisateur, le tout entouré de super collègues, c&#8217;est cool.</p>
</div>
<div class="paragraph">
<p>Les challenges techniques sont là, et c&#8217;est très satisfaisant de mettre ce genre de produits en prod et ensuite de voir les gens commencer à les utiliser (même ce blog est derrière le load balancer dont je parle dans cet article par exemple !).</p>
</div>
</div>
</div>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags/cloud/">cloud</a>
    
    <a href="/tags/programming/">programming</a>
    
</div>


    <div id="prev-next">
        
        <a href="/posts/2020-12-04-pull-push/">&laquo; Métriques, monitoring, push vs pull, Riemann, Vector</a>
        
        
        <a class="right" href="/posts/2020-11-11-commentator/">Commentator: commentaires de blogs, basé sur S3 &raquo;</a>
        
    </div>
    <!--Crappy code starts here-->
    
    <script>
      $( document ).ready(function() {
          $.get("https://comments.mcorbin.fr/api/v1/challenge", function(data) {
              $('#challenge_question').text(data.question);
              $('#challenge_name span').text(data.name);
          });
          $.get("https://comments.mcorbin.fr/api/v1/comment/2020-11-29-developpeur-cloud", function(data) {
              for (i=0; i<data.length; i++) {

                  response = data[i];
                  author = document.createElement('div');
                  author.className="comment_author";
                  author.textContent=response.author;

                  d = new Date(response.timestamp);
                  datestring = d.getFullYear() + "/" + (d.getMonth()+1) + "/" + d.getDate() + " " + d.getHours() + "h" + d.getMinutes();

                  date = document.createElement('span');
                  date.className="comment_date";
                  date.textContent=datestring;

                  content = document.createElement('div');
                  content.className="comment_content";
                  content.innerHTML=response.content;
                  content.style="white-space: pre-wrap;";


                  comment = document.createElement('div');
                  comment.className="comment";

                  comment.appendChild(author);
                  comment.appendChild(date);
                  comment.appendChild(content);

                  document.getElementById('comments_list').appendChild(comment);
              }
          });
      });
      $(function(){
          $('#comment_create').on('click', function(){
              $.ajax
              ({
                  type: "POST",
                  url: "https://comments.mcorbin.fr/api/v1/comment/2020-11-29-developpeur-cloud",
                  dataType: 'json',
                  contentType: 'application/json',
                  data: JSON.stringify({"author": $("#new_comment_author").val(),
                                        "content" : $("#new_comment_content").val(),
                                        "challenge" : $("#challenge_name span").text(),
                                        "answer" : $("#challenge_answer").val()}),
                  success: function () {
                      $('#comment_result span').text("The comment will be approved soon.");
                  },
                  error: function () {
                      $('#comment_result span').text("Fail to add the comment. Please contact the website owner (the email is in the About section of the website). Thank you in advance.");
                  }
              })
          });
      });
    </script>

    <div id="comment_block">
      <div id="comments_list">
      </div>

      <div id="new_comment">

        <div id="challenge_name" style="visibility: hidden">
          <span  style="visibility: hidden"></span>
        </div>
        <b><p>Add a comment</p></b>
        <input type="text" id="new_comment_author" name="author" placeholder="author"><br><br>

        <textarea id="new_comment_content", name="comment_content" rows="5" placeholder="content"></textarea>
        <br><br>

        <b><span id="challenge_question"></span></b><br/>
        <input type="text" id="challenge_answer" name="challenge_answer" placeholder="Answer" size="40"><br><br>
        <p>If you have a bug/issue with the commenting system, please send me an email (my email is in the "About" section).</p>
        <input id="comment_create" type="button" value="Add comment" class="btn btn-primary btn-lg"/>
        <div id="comment_result">
          <span></span>
        </div>
      </div>

    </div>
    
    <!--Ends here-->
</div>

            <a href="#top" class="alink" >Top of page</a>
          </div>
        </div>
      </div>
      <footer>Copyright &copy; 2020 mcorbin</footer>
    </div>
    <script src="/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/js/highlight.pack.js" type="text/javascript"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
